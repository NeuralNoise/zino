<html>
    <head>
        <title>In-site windows</title>
        <style type="text/css">
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
        }
        body {
            background-color: #ffffee;
        }
        div.puffin {
            border: 1px solid black;
            background-color: #eee;
            position: fixed;
        }
        </style>
        <script type="text/javascript" src="http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js" charset="utf-8"></script>
        <script type="text/javascript">
            var Puffin = {
                c: {
                    RESIZE_N: 'N',
                    RESIZE_NE: 'NE',
                    RESIZE_E: 'E',
                    RESIZE_SE: 'SE',
                    RESIZE_S: 'S',
                    RESIZE_SW: 'SW',
                    RESIZE_W: 'W',
                    RESIZE_NW: 'NW',
					RESIZE_BORDER: 6, // in pixels
					MIN_W: 20,
					MIN_H: 20
                },
                create: function () {
                    var obj = {
                        div: null,
                        x: 0, y: 0, w: 0, h: 0, visible: false,
                        movable: true, moving: false, resizing: false,
                        move: function ( x, y ) {
                            // check window is within boundaries
                            if ( x < 0 ) {
                                x = 0;
                            }
                            if ( y < 0 ) {
                                y = 0;
                            }
                            if ( x > this.maxx - this.w ) {
                                x = this.maxx - this.w;
                            }
                            if ( y > this.maxy - this.h ) {
                                y = this.maxy - this.h;
                            }
							
							var ret = !( this.x == x && this.y == y );
							
                            this.x = x;
                            this.y = y;
                            this.div.style.left = x + 'px';
                            this.div.style.top = y + 'px';
							
							return ret;
                        },
                        resize: function ( w, h ) {
							if ( w < Puffin.c.MIN_W ) {
								w = Puffin.c.MIN_W;
							}
							if ( h < Puffin.c.MIN_H ) {
								h = Puffin.c.MIN_H;
							}
							
							var ret = !( this.w == w && this.h == h );
                            
							this.w = w;
                            this.h = h;
                            this.div.style.width = w + 'px';
                            this.div.style.height = h + 'px';
							
							return ret;
                        },
                        hide: function () {
                            this.visible = false;
                            this.div.style.display = 'none';
                        },
                        show: function () {
                            this.visible = true;
                            this.div.style.display = 'block';
                        },
                        __construct: function () {
                            this.div = document.createElement( 'div' );
                            this.div.className = 'puffin';
                            this.div.onmousedown = ( function( me ) {
                                return function( e ) {
                                    if ( !e ) {
                                        e = window.event;
                                    }
                                    // position of mouse within window
                                    var xpos = e.clientX - me.x;
                                    var ypos = e.clientY - me.y;
									var resizeType = Puffin.getResizeType( me, { x: e.clientX, y: e.clientY } );
                                    if ( resizeType !== false ) {
                                        me.resizing = resizeType;
                                    }
                                    else {
                                        me.moving = true;
                                    }
                                    me.capture = {
                                        clientX: e.clientX,
                                        clientY: e.clientY,
                                        x: me.x, y: me.y,
                                        h: me.h, w: me.w
                                    };
                                    me.maxx = $( window ).width();
                                    me.maxy = $( window ).height();
                                    return false;
                                };
                            } )( this );
                            var f = function () {};
                            if ( typeof document.body.onmouseup == 'function' ) {
                                var f = document.body.onmouseup;
                            }
                            document.body.onmouseup = ( function( me ) {
                                return function() {
                                    me.moving = false;
                                    me.resizing = false;
                                    f();
                                };
                            } )( this );
                            var f = function () {};
                            if ( typeof document.body.onmousemove == 'function' ) {
                                var f = document.body.onmousemove;
                            }
                            document.body.onmousemove = ( function( me ) {
                                return function( e ) {
                                    if ( !e ) {
                                        e = window.event;
                                    }
                                    if ( me.moving ) {
                                        me.move( e.clientX - me.capture.clientX + me.capture.x, e.clientY - me.capture.clientY + me.capture.y );
                                    }
                                    if ( me.resizing !== false ) {
                                        var coords = Puffin.resizeEval( me, me.resizing, me.capture, { x: e.clientX, y: e.clientY } );
                                        if ( me.resize( coords[ 2 ], coords[ 3 ] ) ) {
											me.move( coords[ 0 ], coords[ 1 ] );
										}
                                    }
                                    f();
                                };
                            } )( this );
							this.div.onmousemove = ( function ( me ) {
								return function ( e ) {
									if ( !e ) {
										e = window.event;
									}
									var resizeType = Puffin.getResizeType( me, { x: e.clientX, y: e.clientY } );
									if ( resizeType === false ) {
										me.div.style.cursor = 'default';
									}
									else {
										me.div.style.cursor = resizeType + '-resize';
									}
								}
							} )( this );
                            this.hide();
                            document.body.appendChild( this.div );
                        }
                    };
                    obj.__construct();
                    return obj;
                },
                resizeEval: function ( obj, direction, capture, mouse ) {
					var combine = function ( a, b ) {
						var c = a;
						
						if ( a[ 0 ] == obj.x ) {
							c[ 0 ] = b[ 0 ];
						}
						if ( a[ 1 ] == obj.y ) {
							c[ 1 ] = b[ 1 ];
						}
						if ( a[ 2 ] == obj.w ) {
							c[ 2 ] = b[ 2 ];
						}
						if ( a[ 3 ] == obj.h ) {
							c[ 3 ] = b[ 3 ];
						}
						
						return c;
					}
					var get = function ( dir ) {
						switch ( dir ) {
							case Puffin.c.RESIZE_N:
								return [
									obj.x, capture.y - capture.clientY + mouse.y,
									obj.w, capture.clientY + capture.h - mouse.y 
								];
							case Puffin.c.RESIZE_W:
								return [
									capture.x - capture.clientX + mouse.x, obj.y,
									capture.clientX + capture.w - mouse.x, obj.h
								];
							case Puffin.c.RESIZE_S:
								return [
									obj.x, obj.y,
									obj.w, capture.h + mouse.y - capture.clientY
								];
							case Puffin.c.RESIZE_E:
								return [
									obj.x, obj.y,
									capture.w + mouse.x - capture.clientX, obj.h
								];
							case Puffin.c.RESIZE_NW:
								return combine( get( Puffin.c.RESIZE_N ), get( Puffin.c.RESIZE_W ) );
							case Puffin.c.RESIZE_NE:
								return combine( get( Puffin.c.RESIZE_N ), get( Puffin.c.RESIZE_E ) );
							case Puffin.c.RESIZE_SE:
								return combine( get( Puffin.c.RESIZE_S ), get( Puffin.c.RESIZE_E ) );
							case Puffin.c.RESIZE_SW:
								return combine( get( Puffin.c.RESIZE_S ), get( Puffin.c.RESIZE_W ) );
						}
					};
					return get( direction );
                },
				getResizeType: function ( obj, mouse ) {
					var xx = 0;
					var yy = 0;
					
					if ( mouse.x >= obj.x && mouse.x < obj.x + Puffin.c.RESIZE_BORDER ) {
						xx = -1;
					}
					if ( mouse.x <= obj.x + obj.w && mouse.x > obj.x + obj.w - Puffin.c.RESIZE_BORDER ) {
						xx = 1;
					}
					if ( mouse.y >= obj.y && mouse.y < obj.y + Puffin.c.RESIZE_BORDER ) {
						yy = -1;
					}
					if ( mouse.y <= obj.y + obj.h && mouse.y > obj.y + obj.h - Puffin.c.RESIZE_BORDER ) {
						yy = 1;
					}
					
					switch ( xx ) {
						case -1:
							switch ( yy ) {
								case -1:
									return Puffin.c.RESIZE_NW;
								case 1:
									return Puffin.c.RESIZE_SW;
							}
							return Puffin.c.RESIZE_W;
						case 1:
							switch ( yy ) {
								case -1:
									return Puffin.c.RESIZE_NE;
								case 1:
									return Puffin.c.RESIZE_SE;
							}
							return Puffin.c.RESIZE_E;
					}
					switch ( yy ) {
						case -1:
							return Puffin.c.RESIZE_N;
						case 1:
							return Puffin.c.RESIZE_S;
					}
					return false;
				}
            };

        </script>
    </head>
    <body>
        <script type="text/javascript">
            var myWindow = Puffin.create();
            myWindow.move( 100, 100 );
            myWindow.resize( 200, 300 );
            myWindow.show();
        </script>
    </body>
</html>

